name: AssetStudio 自动化构建与打包

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build-and-package:
    runs-on: windows-latest

    steps:
      - name: 拉取代码
        uses: actions/checkout@v4

      - name: 安装 .NET 运行时
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: 6.0.x  # 匹配项目实际依赖版本

      - name: 还原项目依赖
        run: dotnet restore AssetStudio-Neptune.sln

      - name: 构建项目（Release 模式）
        run: dotnet build AssetStudio-Neptune.sln --configuration Release --no-restore

      - name: 压缩构建产物
        run: |
          # 定义构建产物目录（根据项目输出路径调整）
          $buildOutputPath = "AssetStudio.CLI/bin/Release/net6.0"
          # 定义压缩包名称（包含当前日期，避免重名）
          $zipName = "AssetStudio-Build-$(Get-Date -Format 'yyyyMMdd-HHmmss').zip"
          # 使用 PowerShell 压缩目录
          Compress-Archive -Path "$buildOutputPath/*" -DestinationPath "$zipName" -Force
        shell: pwsh

      - name: 上传压缩包作为 Artifact
        uses: actions/upload-artifact@v4
        with:
          name: assetstudio-build
          path: "*.zip"  # 上传所有 zip 压缩包（即上一步生成的构建产物）
          retention-days: 7  # 保留 7 天，可按需调整
